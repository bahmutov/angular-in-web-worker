<!DOCTYPE html>
<html lang="en">

<head>
</head>

<body>
  <h2>Angular 1.x in Web Worker</h2>
  <p>loads angular in a web worker. The loaded angular will run a digest cycle after 1 second
  and will send rendered HTML to the main browser window (here). To run, load the index.html
  using a local webserver, for example <a href="https://www.npmjs.com/package/http-server">http-server</a>.</p>
  <div id="output">rendered HTML from web worker will replace this text.</div>

  <button id="render" disabled="disabled">Render in Web Worker</button>

  <!-- angular app to send to the web worker -->
  <!--
  <script src="app-hello-world.js"></script>
  -->
  <script src="app-calendar.js"></script>
  <script src="node_modules/console-log-div/console-log-div.js"></script>
  <script>
    console.log('trying to load angular web worker');
    var worker = new Worker('angular-web-worker.js');

    worker.onmessage = function (e) {
      console.log('received message from angular web worker');
      if (e.data === 'worker-angular-ready') {
        console.log(e.data);

        var button = document.getElementById('render');
        button.attributes.removeNamedItem('disabled');
        button.addEventListener('click', function () {
          console.log('sending app definition to web worker');

          if (typeof appDefinition.setupApp === 'function') {
            appDefinition.setupApp = appDefinition.setupApp.toString();
          }

          if (typeof appDefinition.renderedApp === 'function') {
            appDefinition.renderedApp = appDefinition.renderedApp.toString();
          }

          console.time('render');
          console.profile('render');
          worker.postMessage(appDefinition);
        });

      } else {
        // console.log('unknown message');
        // console.log(e.data);
        document.getElementById('output').innerHTML = e.data;
        console.profileEnd('render');
        console.timeEnd('render');
      }
    };
  </script>
</body>
</html>
